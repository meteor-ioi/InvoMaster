# DocLayout-YOLO 版面识别参数调研与建议

## 1. 核心参数分析

除了现有的 **`conf` (置信度)**，以下是 YOLO 推理引擎中对文档版面分析至关重要的参数：

| 参数名称 | 作用说明 | 使用示例 / 效果 |
| :--- | :--- | :--- |
| **`iou`** | **NMS 交并比阈值**。控制 Non-Maximum Suppression 的抑制程度。降低该值会减少重叠框，提高该值允许更多邻近目标的并存。 | `iou=0.45` (默认)。在单据中若出现“表格内部又识别出文字块”的情况，调低 iou 可合并或抑制重叠。 |
| **`imgsz`** | **推理分辨率**。模型输入的图像尺寸（通常为 32 的倍数）。 | `imgsz=1280`。对于包含微小文字或细密表格线的工业单据，提高分辨率能显著提升检出率，但会增加耗时和显存占用。 |
| **`agnostic_nms`** | **类别无关 NMS**。是否对不同种类的重叠框也进行抑制。 | `agnostic_nms=True`。工业单据中常有“表格”与“图形”重叠的情况，开启此项可强制只保留置信度最高的一个分类，避免框重叠。 |
| **`max_det`** | **最大检测数**。每张页面允许检测出的最大目标数量。 | `max_det=300`。对于条目极繁琐的装箱单，需调高此值防止目标被截断。 |
| **`classes`** | **类别过滤**。仅显示或提取特定类型的区域。 | `classes=[1, 5]` (假设 1 是表格, 5 是标题)。如果用户只想看表格，可以过滤掉页眉页脚等干扰项。 |
| **`augment`** | **测试时增强 (TTA)**。通过翻转、缩放等多次推理取平均。 | `augment=True`。牺牲速度（慢约 2-3 倍）换取极致的召回率，适合极难识别的模糊单据。 |

---

## 2. 针对工业单据的解决方案建议

在工业 PDF 处理场景中，我们需要在“识别深度”和“交互流畅度”之间寻找平衡。

### 方案 A：场景预设模式 (Scenario Presets)
**设计思路**: 不向用户暴露晦涩的参数名，而是提供语义化的“模式开关”。
- **「标准模式」**: `conf=0.25`, `iou=0.45`, `imgsz=1024`。兼顾速度与准确率。
- **「精准补全」**: `conf=0.15`, `imgsz=1600`, `agnostic_nms=True`。针对密集文字单据，牺牲速度以降低漏检风险。
- **「仅看表格」**: `classes=[table_id]`。自动过滤非表格元素，简化用户校验干扰。

### 方案 B：自适应动态参数 (Adaptive Engine)
**设计思路**: 根据单据的物理特征自动调整后端参数。
- **高像素优先**: 如果上传的 PDF 转换成图像后分辨率极高（如 A3 尺寸或 600DPI），后端自动将 `imgsz` 提升至 1600。
- **自适应置信度**: 如果 AI 识别出的目标少于 3 个且置信度都在 0.3 附近，系统自动触发一次低置信度 (`conf=0.1`) 的二次扫描。

### 方案 C：交互式“透视镜” (Interactive X-Ray)
**设计思路**: 在前端 UI 提供一个“探测深度”滑块。
- **滑块左侧**: 高置信度，界面清爽，只显示确定性高的区域。
- **滑块右侧**: 低置信度 + 高 `imgsz`，界面显示大量淡色候选框，方便用户一键“确认”转为正式区域。

---

## 3. 综合方案建议 (集成路径)

1.  **第一步 (低成本/高收益)**: 引入 **`imgsz`** 和 **`iou`** 到后端。允许前端传递这两个参数。
2.  **第二步 (提升体验)**: 采用 **方案 A**。在前端界面增加一个「识别策略」下拉框：
    - ⚡️ **极速** (低分辨率)
    - ⚖️ **平衡** (默认)
    - 🔍 **精细** (高分辨率 + 低阈值 + NMS 抑制)
3.  **第三步 (进阶)**: 引入 **`classes` 过滤开关**。在侧边栏允许用户勾选“只看表格”、“不看页眉页脚”，动态更新画布。

这种分级配置既能满足极客用户对参数的掌控感，又能保证普通用户通过简单的“模式切换”获得最佳效果。
